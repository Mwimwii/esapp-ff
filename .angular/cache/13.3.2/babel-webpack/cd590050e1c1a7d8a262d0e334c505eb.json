{"ast":null,"code":"import { DataService } from '../../../../services/data-service';\nimport { FormGroup } from '@angular/forms';\nimport { NzNotificationService } from 'ng-zorro-antd/notification';\nimport { filter } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../services/data-service\";\nimport * as i2 from \"ng-zorro-antd/notification\";\n\nfunction FaabsAttendanceSheetComponent_tr_19_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 9);\n    i0.ɵɵlistener(\"nzCheckedChange\", function FaabsAttendanceSheetComponent_tr_19_Template_td_nzCheckedChange_1_listener($event) {\n      var restoredCtx = i0.ɵɵrestoreView(_r4);\n      var data_r2 = restoredCtx.$implicit;\n      var ctx_r3 = i0.ɵɵnextContext();\n      return ctx_r3.mapOfCheckedId[data_r2.id] = $event;\n    })(\"nzCheckedChange\", function FaabsAttendanceSheetComponent_tr_19_Template_td_nzCheckedChange_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      var ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.refreshStatus();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"td\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    var data_r2 = ctx.$implicit;\n    var ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"nzChecked\", ctx_r1.mapOfCheckedId[data_r2.id])(\"nzDisabled\", data_r2.disabled);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate3(\"\", data_r2.Title, \"\", data_r2.first_name, \" \", data_r2.last_name, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r2.nrc);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.farmerAttendance[data_r2.id] ? ctx_r1.farmerAttendance[data_r2.id] : 0);\n  }\n}\n\nvar FaabsAttendanceSheetComponent =\n/** @class */\nfunction () {\n  function FaabsAttendanceSheetComponent(http, notification) {\n    this.http = http;\n    this.notification = notification;\n    this.loading = false;\n    this.data = []; // Table variables\n\n    this.listOfAllData = [];\n    this.isAllDisplayDataChecked = false;\n    this.isOperating = false;\n    this.isIndeterminate = false;\n    this.mapOfCheckedId = {};\n    this.numberOfChecked = 0;\n    this.listOfDisplayData = []; // Form variables\n\n    this.farmerAttendance = {};\n    this.faabsFacilitators = 'ESAPP';\n    this.faabsPartnerOrg = 'IFADD';\n    this.campOfficerID = 10; // FormlyUploadField forms\n\n    this.form = new FormGroup({});\n    this.model = {};\n    this.fields = [// {\n      //   key: \"topic\",\n      //   type: 'select',\n      //   templateOptions: {\n      //     type: 'text',\n      //     label: \"Topic\",\n      //     placeholder: \"Select a Topic\",\n      //     options: []\n      //   },\n      // }\n    ];\n  }\n\n  FaabsAttendanceSheetComponent.prototype.currentPageDataChange = function ($event) {\n    this.listOfDisplayData = $event;\n    this.refreshStatus();\n  };\n\n  FaabsAttendanceSheetComponent.prototype.refreshStatus = function () {\n    var _this = this;\n\n    this.isAllDisplayDataChecked = this.listOfDisplayData.filter(function (item) {\n      return !item.disabled;\n    }).every(function (item) {\n      return _this.mapOfCheckedId[item.id];\n    });\n    this.isIndeterminate = this.listOfDisplayData.filter(function (item) {\n      return !item.disabled;\n    }).some(function (item) {\n      return _this.mapOfCheckedId[item.id];\n    }) && !this.isAllDisplayDataChecked;\n    this.numberOfChecked = this.listOfAllData.filter(function (item) {\n      return _this.mapOfCheckedId[item.id];\n    }).length;\n  };\n\n  FaabsAttendanceSheetComponent.prototype.ngOnInit = function () {\n    var _this = this;\n\n    console.log('Faabs Group Id OnInit: ', this.faabsGroupId);\n    this.http.getFaabsTopics().subscribe(function (data) {\n      _this.topics = data;\n    }); // Get the FaaBs Group ID\n\n    this.http.getFaabsGroups().subscribe(function (data) {\n      _this.faabsGroup = data.filter(function (item) {\n        return item.id === _this.faabsGroupId;\n      })[0]; // why does this become undefined\n\n      console.log('Faabs Group Id: ', _this.faabsGroupId);\n    });\n    this.http.getFaabsAttendanceRegister().subscribe(function (data) {\n      var attendance = data.filter(function (item) {\n        return item.faabs_group_id === 5;\n      });\n      _this.farmerAttendance = _this.arrayToObj(attendance, 'farmer_id');\n    });\n    this.http.getCategoryAFarmers().pipe(filter(function (farmer) {\n      return farmer.faabs_group_id === _this.faabsGroupId;\n    })).subscribe(function (data) {\n      return _this.listOfAllData = data;\n    });\n  }; // perform a count by farmer id\n\n\n  FaabsAttendanceSheetComponent.prototype.arrayToObj = function (data, key) {\n    return data.reduce(function (acc, curr) {\n      return acc[curr[key]] ? ++acc[curr[key]] : acc[curr[key]] = 1, acc;\n    }, {});\n  };\n\n  FaabsAttendanceSheetComponent.prototype.checkAll = function (value) {\n    var _this = this;\n\n    this.listOfDisplayData.filter(function (item) {\n      return !item.disabled;\n    }).forEach(function (item) {\n      return _this.mapOfCheckedId[item.id] = value;\n    });\n    this.refreshStatus();\n  };\n\n  FaabsAttendanceSheetComponent.prototype.operateData = function () {\n    var _this = this;\n\n    this.isOperating = true;\n    setTimeout(function () {\n      _this.listOfAllData.forEach(function (item) {\n        return _this.mapOfCheckedId[item.id] = false;\n      });\n\n      _this.refreshStatus();\n\n      _this.isOperating = false;\n    }, 1000);\n  };\n\n  FaabsAttendanceSheetComponent.prototype.submit = function (model) {\n    var _this = this; // Ensure that the type safety is maintained\n\n\n    this.listOfAllData.filter(function (farmer) {\n      return _this.mapOfCheckedId[farmer.id];\n    }).map(function (farmer) {\n      return {\n        faabs_group_id: _this.faabsGroupId,\n        facilitators: _this.faabsFacilitators,\n        partner_organisations: _this.faabsPartnerOrg,\n        training_date: new Date(),\n        duration: '2:30',\n        quarter: '2',\n        created_by: _this.campOfficerID,\n        updated_by: _this.campOfficerID,\n        topic: _this.topics[0].topic,\n        topic_indicator: _this.topics[0].output_level_indicator,\n        topic_subcomponent: _this.topics[0].subcomponent,\n        training_type: 'Participants under non-Direct/Other Training [Stream 2]',\n        farmer_id: farmer.id,\n        full_names: farmer.first_name + ' ' + farmer.other_names + farmer.last_name,\n        youth_non_youth: 'Non Youth',\n        marital_status: farmer['marital_status'],\n        sex: farmer['sex'],\n        year_of_birth: '1992'\n      };\n    }).map(function (item) {\n      return _this.http.postFaabsAttendance(item);\n    }).forEach(function (postData) {\n      console.log(postData);\n      postData.subscribe(function (data) {\n        return console.log(data);\n      });\n    });\n    this.notification.success('Attendance Marked', 'Attendance have been successfully marked!');\n  };\n\n  FaabsAttendanceSheetComponent.ɵfac = function FaabsAttendanceSheetComponent_Factory(t) {\n    return new (t || FaabsAttendanceSheetComponent)(i0.ɵɵdirectiveInject(i1.DataService), i0.ɵɵdirectiveInject(i2.NzNotificationService));\n  };\n\n  FaabsAttendanceSheetComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: FaabsAttendanceSheetComponent,\n    selectors: [[\"app-register-attendants-form\"]],\n    inputs: {\n      faabsGroupId: \"faabsGroupId\"\n    },\n    decls: 24,\n    vars: 9,\n    consts: [[1, \"table-responsive\", \"text-wrap\"], [\"nz-form\", \"\", 3, \"formGroup\", \"nzLayout\", \"ngSubmit\"], [3, \"form\", \"fields\", \"model\"], [\"nzShowPagination\", \"\", \"nzShowSizeChanger\", \"\", 3, \"nzData\", \"nzCurrentPageDataChange\"], [\"basicTable\", \"\"], [\"nzShowCheckbox\", \"\", 3, \"nzChecked\", \"nzIndeterminate\", \"nzCheckedChange\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"reset\", 1, \"btn\", \"btn-danger\", \"ml-2\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"], [\"nzShowCheckbox\", \"\", 3, \"nzChecked\", \"nzDisabled\", \"nzCheckedChange\"]],\n    template: function FaabsAttendanceSheetComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"form\", 1);\n        i0.ɵɵlistener(\"ngSubmit\", function FaabsAttendanceSheetComponent_Template_form_ngSubmit_1_listener() {\n          return ctx.submit(ctx.model);\n        });\n        i0.ɵɵelementStart(2, \"formly-form\", 2)(3, \"div\")(4, \"strong\");\n        i0.ɵɵtext(5, \"Attendance\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(6, \"br\");\n        i0.ɵɵelementStart(7, \"nz-table\", 3, 4);\n        i0.ɵɵlistener(\"nzCurrentPageDataChange\", function FaabsAttendanceSheetComponent_Template_nz_table_nzCurrentPageDataChange_7_listener($event) {\n          return ctx.currentPageDataChange($event);\n        });\n        i0.ɵɵelementStart(9, \"thead\")(10, \"tr\")(11, \"th\", 5);\n        i0.ɵɵlistener(\"nzCheckedChange\", function FaabsAttendanceSheetComponent_Template_th_nzCheckedChange_11_listener($event) {\n          return ctx.isAllDisplayDataChecked = $event;\n        })(\"nzCheckedChange\", function FaabsAttendanceSheetComponent_Template_th_nzCheckedChange_11_listener($event) {\n          return ctx.checkAll($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"th\");\n        i0.ɵɵtext(13, \"Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"th\");\n        i0.ɵɵtext(15, \"NRC\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"th\");\n        i0.ɵɵtext(17, \"Graduation Status\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(18, \"tbody\");\n        i0.ɵɵtemplate(19, FaabsAttendanceSheetComponent_tr_19_Template, 8, 7, \"tr\", 6);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(20, \"button\", 7);\n        i0.ɵɵtext(21, \"Reset\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"button\", 8);\n        i0.ɵɵtext(23, \"Submit\");\n        i0.ɵɵelementEnd()()()();\n      }\n\n      if (rf & 2) {\n        var _r0 = i0.ɵɵreference(8);\n\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.form)(\"nzLayout\", \"vertical\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"form\", ctx.form)(\"fields\", ctx.fields)(\"model\", ctx.model);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"nzData\", ctx.listOfAllData);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"nzChecked\", ctx.isAllDisplayDataChecked)(\"nzIndeterminate\", ctx.isIndeterminate);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngForOf\", _r0.data);\n      }\n    },\n    styles: [\"\"]\n  });\n  return FaabsAttendanceSheetComponent;\n}();\n\nexport { FaabsAttendanceSheetComponent };","map":null,"metadata":{},"sourceType":"module"}