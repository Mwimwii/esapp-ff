{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\admin\\\\Documents\\\\work\\\\ESAPP\\\\esapp-mobile\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\classCallCheck.js\";\nimport _createClass from \"C:\\\\Users\\\\admin\\\\Documents\\\\work\\\\ESAPP\\\\esapp-mobile\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\createClass.js\";\nimport { __decorate, __metadata } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"./faabs-attendance-sheet.component.html?ngResource\";\nimport __NG_CLI_RESOURCE__1 from \"./faabs-attendance-sheet.component.scss?ngResource\";\nimport { Component, Input } from '@angular/core';\nimport { DataService } from '../../../../services/data-service';\nimport { FormGroup } from '@angular/forms';\nimport { NzNotificationService } from 'ng-zorro-antd/notification';\nimport { filter } from 'rxjs/operators';\n\nvar FaabsAttendanceSheetComponent = /*#__PURE__*/function () {\n  function FaabsAttendanceSheetComponent(http, notification) {\n    _classCallCheck(this, FaabsAttendanceSheetComponent);\n\n    this.http = http;\n    this.notification = notification;\n    this.loading = false;\n    this.data = []; // Table variables\n\n    this.listOfAllData = [];\n    this.isAllDisplayDataChecked = false;\n    this.isOperating = false;\n    this.isIndeterminate = false;\n    this.mapOfCheckedId = {};\n    this.numberOfChecked = 0;\n    this.listOfDisplayData = []; // Form variables\n\n    this.farmerAttendance = {};\n    this.faabsFacilitators = 'ESAPP';\n    this.faabsPartnerOrg = 'IFADD';\n    this.campOfficerID = 10; // FormlyUploadField forms\n\n    this.form = new FormGroup({});\n    this.model = {};\n    this.fields = [// {\n      //   key: \"topic\",\n      //   type: 'select',\n      //   templateOptions: {\n      //     type: 'text',\n      //     label: \"Topic\",\n      //     placeholder: \"Select a Topic\",\n      //     options: []\n      //   },\n      // }\n    ];\n  }\n\n  _createClass(FaabsAttendanceSheetComponent, [{\n    key: \"currentPageDataChange\",\n    value: function currentPageDataChange($event) {\n      this.listOfDisplayData = $event;\n      this.refreshStatus();\n    }\n  }, {\n    key: \"refreshStatus\",\n    value: function refreshStatus() {\n      var _this = this;\n\n      this.isAllDisplayDataChecked = this.listOfDisplayData.filter(function (item) {\n        return !item.disabled;\n      }).every(function (item) {\n        return _this.mapOfCheckedId[item.id];\n      });\n      this.isIndeterminate = this.listOfDisplayData.filter(function (item) {\n        return !item.disabled;\n      }).some(function (item) {\n        return _this.mapOfCheckedId[item.id];\n      }) && !this.isAllDisplayDataChecked;\n      this.numberOfChecked = this.listOfAllData.filter(function (item) {\n        return _this.mapOfCheckedId[item.id];\n      }).length;\n    }\n  }, {\n    key: \"ngOnInit\",\n    value: function ngOnInit() {\n      var _this2 = this;\n\n      console.log('Faabs Group Id OnInit: ', this.faabsGroupId);\n      this.http.getFaabsTopics().subscribe(function (data) {\n        _this2.topics = data;\n      }); // Get the FaaBs Group ID\n\n      this.http.getFaabsGroups().subscribe(function (data) {\n        _this2.faabsGroup = data.filter(function (item) {\n          return item.id === _this2.faabsGroupId;\n        })[0]; // why does this become undefined\n\n        console.log('Faabs Group Id: ', _this2.faabsGroupId);\n      });\n      this.http.getFaabsAttendanceRegister().subscribe(function (data) {\n        var attendance = data.filter(function (item) {\n          return item.faabs_group_id === 5;\n        });\n        _this2.farmerAttendance = _this2.arrayToObj(attendance, 'farmer_id');\n      });\n      this.http.getCategoryAFarmers().pipe(filter(function (farmer) {\n        return farmer.faabs_group_id === _this2.faabsGroupId;\n      })).subscribe(function (data) {\n        return _this2.listOfAllData = data;\n      });\n    } // perform a count by farmer id\n\n  }, {\n    key: \"arrayToObj\",\n    value: function arrayToObj(data, key) {\n      return data.reduce(function (acc, curr) {\n        return acc[curr[key]] ? ++acc[curr[key]] : acc[curr[key]] = 1, acc;\n      }, {});\n    }\n  }, {\n    key: \"checkAll\",\n    value: function checkAll(value) {\n      var _this3 = this;\n\n      this.listOfDisplayData.filter(function (item) {\n        return !item.disabled;\n      }).forEach(function (item) {\n        return _this3.mapOfCheckedId[item.id] = value;\n      });\n      this.refreshStatus();\n    }\n  }, {\n    key: \"operateData\",\n    value: function operateData() {\n      var _this4 = this;\n\n      this.isOperating = true;\n      setTimeout(function () {\n        _this4.listOfAllData.forEach(function (item) {\n          return _this4.mapOfCheckedId[item.id] = false;\n        });\n\n        _this4.refreshStatus();\n\n        _this4.isOperating = false;\n      }, 1000);\n    }\n  }, {\n    key: \"submit\",\n    value: function submit(model) {\n      var _this5 = this;\n\n      // Ensure that the type safety is maintained\n      this.listOfAllData.filter(function (farmer) {\n        return _this5.mapOfCheckedId[farmer.id];\n      }).map(function (farmer) {\n        return {\n          faabs_group_id: _this5.faabsGroupId,\n          facilitators: _this5.faabsFacilitators,\n          partner_organisations: _this5.faabsPartnerOrg,\n          training_date: new Date(),\n          duration: '2:30',\n          quarter: '2',\n          created_by: _this5.campOfficerID,\n          updated_by: _this5.campOfficerID,\n          topic: _this5.topics[0].topic,\n          topic_indicator: _this5.topics[0].output_level_indicator,\n          topic_subcomponent: _this5.topics[0].subcomponent,\n          training_type: 'Participants under non-Direct/Other Training [Stream 2]',\n          farmer_id: farmer.id,\n          full_names: farmer.firstName + ' ' + farmer.other_names + farmer.last_name,\n          youth_non_youth: 'Non Youth',\n          marital_status: farmer['marital_status'],\n          sex: farmer['sex'],\n          year_of_birth: '1992'\n        };\n      }).map(function (item) {\n        return _this5.http.postFaabsAttendance(item);\n      }).forEach(function (postData) {\n        console.log(postData);\n        postData.subscribe(function (data) {\n          return console.log(data);\n        });\n      });\n      this.notification.success('Attendance Marked', 'Attendance have been successfully marked!');\n    }\n  }]);\n\n  return FaabsAttendanceSheetComponent;\n}();\n\nFaabsAttendanceSheetComponent.ctorParameters = function () {\n  return [{\n    type: DataService\n  }, {\n    type: NzNotificationService\n  }];\n};\n\nFaabsAttendanceSheetComponent.propDecorators = {\n  faabsGroupId: [{\n    type: Input\n  }]\n};\nFaabsAttendanceSheetComponent = __decorate([Component({\n  selector: 'app-register-attendants-form',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n}), __metadata(\"design:paramtypes\", [DataService, NzNotificationService])], FaabsAttendanceSheetComponent);\nexport { FaabsAttendanceSheetComponent };","map":null,"metadata":{},"sourceType":"module"}
