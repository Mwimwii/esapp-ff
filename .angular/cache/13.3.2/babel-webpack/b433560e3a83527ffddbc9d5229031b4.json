{"ast":null,"code":"import { DataService } from '../../../../services/data-service';\nimport { FormGroup } from '@angular/forms';\nimport { NzNotificationService } from 'ng-zorro-antd/notification';\nimport { filter } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../services/data-service\";\nimport * as i2 from \"ng-zorro-antd/notification\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"ng-zorro-antd/form\";\nimport * as i5 from \"@ngx-formly/core\";\nimport * as i6 from \"ng-zorro-antd/table\";\nimport * as i7 from \"@angular/common\";\n\nfunction FaabsAttendanceSheetComponent_tr_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 9);\n    i0.ɵɵlistener(\"nzCheckedChange\", function FaabsAttendanceSheetComponent_tr_19_Template_td_nzCheckedChange_1_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r4);\n      const data_r2 = restoredCtx.$implicit;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return ctx_r3.mapOfCheckedId[data_r2.id] = $event;\n    })(\"nzCheckedChange\", function FaabsAttendanceSheetComponent_tr_19_Template_td_nzCheckedChange_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.refreshStatus();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"td\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const data_r2 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"nzChecked\", ctx_r1.mapOfCheckedId[data_r2.id])(\"nzDisabled\", data_r2.disabled);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate3(\"\", data_r2.Title, \"\", data_r2.firstName, \" \", data_r2.last_name, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r2.nrc);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.farmerAttendance[data_r2.id] ? ctx_r1.farmerAttendance[data_r2.id] : 0);\n  }\n}\n\nexport let FaabsAttendanceSheetComponent = /*#__PURE__*/(() => {\n  class FaabsAttendanceSheetComponent {\n    constructor(http, notification) {\n      this.http = http;\n      this.notification = notification;\n      this.loading = false;\n      this.data = []; // Table variables\n\n      this.listOfAllData = [];\n      this.isAllDisplayDataChecked = false;\n      this.isOperating = false;\n      this.isIndeterminate = false;\n      this.mapOfCheckedId = {};\n      this.numberOfChecked = 0;\n      this.listOfDisplayData = []; // Form variables\n\n      this.farmerAttendance = {};\n      this.faabsFacilitators = 'ESAPP';\n      this.faabsPartnerOrg = 'IFADD';\n      this.campOfficerID = 10; // FormlyUploadField forms\n\n      this.form = new FormGroup({});\n      this.model = {};\n      this.fields = [// {\n        //   key: \"topic\",\n        //   type: 'select',\n        //   templateOptions: {\n        //     type: 'text',\n        //     label: \"Topic\",\n        //     placeholder: \"Select a Topic\",\n        //     options: []\n        //   },\n        // }\n      ];\n    }\n\n    currentPageDataChange($event) {\n      this.listOfDisplayData = $event;\n      this.refreshStatus();\n    }\n\n    refreshStatus() {\n      this.isAllDisplayDataChecked = this.listOfDisplayData.filter(item => !item.disabled).every(item => this.mapOfCheckedId[item.id]);\n      this.isIndeterminate = this.listOfDisplayData.filter(item => !item.disabled).some(item => this.mapOfCheckedId[item.id]) && !this.isAllDisplayDataChecked;\n      this.numberOfChecked = this.listOfAllData.filter(item => this.mapOfCheckedId[item.id]).length;\n    }\n\n    ngOnInit() {\n      console.log('Faabs Group Id OnInit: ', this.faabsGroupId);\n      this.http.getFaabsTopics().subscribe(data => {\n        this.topics = data;\n      }); // Get the FaaBs Group ID\n\n      this.http.getFaabsGroups().subscribe(data => {\n        this.faabsGroup = data.filter(item => item.id === this.faabsGroupId)[0]; // why does this become undefined\n\n        console.log('Faabs Group Id: ', this.faabsGroupId);\n      });\n      this.http.getFaabsAttendanceRegister().subscribe(data => {\n        const attendance = data.filter(item => item.faabs_group_id === 5);\n        this.farmerAttendance = this.arrayToObj(attendance, 'farmer_id');\n      });\n      this.http.getCategoryAFarmers().pipe(filter(farmer => farmer.faabs_group_id === this.faabsGroupId)).subscribe(data => this.listOfAllData = data);\n    } // perform a count by farmer id\n\n\n    arrayToObj(data, key) {\n      return data.reduce((acc, curr) => {\n        return acc[curr[key]] ? ++acc[curr[key]] : acc[curr[key]] = 1, acc;\n      }, {});\n    }\n\n    checkAll(value) {\n      this.listOfDisplayData.filter(item => !item.disabled).forEach(item => this.mapOfCheckedId[item.id] = value);\n      this.refreshStatus();\n    }\n\n    operateData() {\n      this.isOperating = true;\n      setTimeout(() => {\n        this.listOfAllData.forEach(item => this.mapOfCheckedId[item.id] = false);\n        this.refreshStatus();\n        this.isOperating = false;\n      }, 1000);\n    }\n\n    submit(model) {\n      // Ensure that the type safety is maintained\n      this.listOfAllData.filter(farmer => this.mapOfCheckedId[farmer.id]).map(farmer => ({\n        faabs_group_id: this.faabsGroupId,\n        facilitators: this.faabsFacilitators,\n        partner_organisations: this.faabsPartnerOrg,\n        training_date: new Date(),\n        duration: '2:30',\n        quarter: '2',\n        created_by: this.campOfficerID,\n        updated_by: this.campOfficerID,\n        topic: this.topics[0].topic,\n        topic_indicator: this.topics[0].output_level_indicator,\n        topic_subcomponent: this.topics[0].subcomponent,\n        training_type: 'Participants under non-Direct/Other Training [Stream 2]',\n        farmer_id: farmer.id,\n        full_names: farmer.firstName + ' ' + farmer.other_names + farmer.last_name,\n        youth_non_youth: 'Non Youth',\n        marital_status: farmer['marital_status'],\n        sex: farmer['sex'],\n        year_of_birth: '1992'\n      })).map(item => this.http.postFaabsAttendance(item)).forEach(postData => {\n        console.log(postData);\n        postData.subscribe(data => console.log(data));\n      });\n      this.notification.success('Attendance Marked', 'Attendance have been successfully marked!');\n    }\n\n  }\n\n  FaabsAttendanceSheetComponent.ɵfac = function FaabsAttendanceSheetComponent_Factory(t) {\n    return new (t || FaabsAttendanceSheetComponent)(i0.ɵɵdirectiveInject(i1.DataService), i0.ɵɵdirectiveInject(i2.NzNotificationService));\n  };\n\n  FaabsAttendanceSheetComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: FaabsAttendanceSheetComponent,\n    selectors: [[\"app-register-attendants-form\"]],\n    inputs: {\n      faabsGroupId: \"faabsGroupId\"\n    },\n    decls: 24,\n    vars: 9,\n    consts: [[1, \"table-responsive\", \"text-wrap\"], [\"nz-form\", \"\", 3, \"formGroup\", \"nzLayout\", \"ngSubmit\"], [3, \"form\", \"fields\", \"model\"], [\"nzShowPagination\", \"\", \"nzShowSizeChanger\", \"\", 3, \"nzData\", \"nzCurrentPageDataChange\"], [\"basicTable\", \"\"], [\"nzShowCheckbox\", \"\", 3, \"nzChecked\", \"nzIndeterminate\", \"nzCheckedChange\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"reset\", 1, \"btn\", \"btn-danger\", \"ml-2\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"], [\"nzShowCheckbox\", \"\", 3, \"nzChecked\", \"nzDisabled\", \"nzCheckedChange\"]],\n    template: function FaabsAttendanceSheetComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"form\", 1);\n        i0.ɵɵlistener(\"ngSubmit\", function FaabsAttendanceSheetComponent_Template_form_ngSubmit_1_listener() {\n          return ctx.submit(ctx.model);\n        });\n        i0.ɵɵelementStart(2, \"formly-form\", 2)(3, \"div\")(4, \"strong\");\n        i0.ɵɵtext(5, \"Attendance\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(6, \"br\");\n        i0.ɵɵelementStart(7, \"nz-table\", 3, 4);\n        i0.ɵɵlistener(\"nzCurrentPageDataChange\", function FaabsAttendanceSheetComponent_Template_nz_table_nzCurrentPageDataChange_7_listener($event) {\n          return ctx.currentPageDataChange($event);\n        });\n        i0.ɵɵelementStart(9, \"thead\")(10, \"tr\")(11, \"th\", 5);\n        i0.ɵɵlistener(\"nzCheckedChange\", function FaabsAttendanceSheetComponent_Template_th_nzCheckedChange_11_listener($event) {\n          return ctx.isAllDisplayDataChecked = $event;\n        })(\"nzCheckedChange\", function FaabsAttendanceSheetComponent_Template_th_nzCheckedChange_11_listener($event) {\n          return ctx.checkAll($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"th\");\n        i0.ɵɵtext(13, \"Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"th\");\n        i0.ɵɵtext(15, \"NRC\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"th\");\n        i0.ɵɵtext(17, \"Graduation Status\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(18, \"tbody\");\n        i0.ɵɵtemplate(19, FaabsAttendanceSheetComponent_tr_19_Template, 8, 7, \"tr\", 6);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(20, \"button\", 7);\n        i0.ɵɵtext(21, \"Reset\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"button\", 8);\n        i0.ɵɵtext(23, \"Submit\");\n        i0.ɵɵelementEnd()()()();\n      }\n\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(8);\n\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.form)(\"nzLayout\", \"vertical\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"form\", ctx.form)(\"fields\", ctx.fields)(\"model\", ctx.model);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"nzData\", ctx.listOfAllData);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"nzChecked\", ctx.isAllDisplayDataChecked)(\"nzIndeterminate\", ctx.isIndeterminate);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngForOf\", _r0.data);\n      }\n    },\n    directives: [i3.ɵNgNoValidate, i3.NgControlStatusGroup, i4.NzFormDirective, i3.FormGroupDirective, i5.FormlyForm, i6.NzTableComponent, i6.NzTheadComponent, i6.NzTrDirective, i6.NzTableCellDirective, i6.NzThMeasureDirective, i6.NzThSelectionComponent, i6.NzTbodyComponent, i7.NgForOf, i6.NzTdAddOnComponent],\n    styles: [\"\"]\n  });\n  return FaabsAttendanceSheetComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}
